---
title: "全站搜索系统说明文档"
date: "2026-01-14"
description: "全站搜索系统的整体设计理念、功能结构、交互逻辑与扩展规范"
tags: ["React", "Next.js","Labs"]
status: "published" # published | draft
---

# 全站搜索系统说明文档

> 本文档用于说明 **全站搜索系统（Search）**
> 的设计目标、数据结构、匹配规则、视觉规范与性能策略。\
> 适用于长期维护、功能扩展与系统级重构。

------------------------------------------------------------------------

## 1. 系统定位

Search 是整个博客系统中的 **统一入口层（Entry
Layer）**，用于跨内容类型的快速查找。

当前支持内容类型：

  类型            路径         定位
  --------------- ------------ ----------
  Notes（笔记）   `/notes/*`   知识沉淀
  Labs（实验）    `/labs/*`    交互实验

核心设计目标：

> **像 Spotlight 一样快，像 App Store 一样清晰。**

------------------------------------------------------------------------

## 2. 设计原则（非常重要）

1.  **统一入口，不混淆语义**
    -   Notes 和 Labs 必须同时可搜索
    -   但必须在视觉与语义上清晰区分
2.  **轻量、前端优先**
    -   不引入搜索引擎
    -   不做复杂评分
    -   静态数据优先、本地过滤
3.  **渐进加载**
    -   Labs：即时可搜索（本地）
    -   Notes：按需加载全文索引

------------------------------------------------------------------------

## 3. 页面结构

    Search Page
    ├─ Header（标题 / 说明）
    ├─ Search Bar（输入框）
    │  └─ Sticky + 高级玻璃拟态
    ├─ Result Meta Bar（结果统计条）
    └─ Result List
       ├─ Note Card
       └─ Lab Card

------------------------------------------------------------------------

## 4. 数据来源与索引

### 4.1 Notes 索引（异步加载）

来源：

    /api/notes-index

结构示例：

``` ts
{
  slug: string
  title: string
  description?: string
  date: string
  tags: string[]
  preview: string
}
```

加载策略：

-   用户首次聚焦输入框时加载
-   或手动点击 `Load Notes Index`
-   仅加载一次，缓存于内存

------------------------------------------------------------------------

### 4.2 Labs 索引（本地静态）

来源：

    /labs/_registry.ts

结构示例：

``` ts
{
  slug: string
  title: string
  description: string
  date: string
  tags: string[]
}
```

特点：

-   不需要网络请求
-   页面初始化即可参与搜索
-   性能极高、稳定

------------------------------------------------------------------------

## 5. 搜索匹配机制

### 5.1 可搜索字段

  内容类型   字段
  ---------- -----------------------------------
  Notes      title, description, tags, preview
  Labs       title, description, tags

### 5.2 匹配方式

``` ts
normalize(text).includes(normalize(query))
```

说明：

-   全部转小写
-   去除首尾空白
-   不做分词、不做权重计算

**原因：** - 数据量小 - 用户主要搜索明确关键词 - 保证即时响应

------------------------------------------------------------------------

## 6. 搜索结果结构

内部统一为：

``` ts
type SearchHit =
  | { kind: "note"; item: NoteItem }
  | { kind: "lab"; item: LabItem }
```

好处：

-   渲染逻辑统一
-   扩展新类型（如 Projects）成本极低

------------------------------------------------------------------------

## 7. 类型徽章（Type Badge）系统

### 7.1 设计目的

> **在混合结果中，一眼区分内容类型**

### 7.2 徽章样式规范

  类型    颜色   Icon           文案
  ------- ------ -------------- ------
  Notes   蓝色   FileText       笔记
  Labs    紫色   FlaskConical   实验

视觉特征：

-   圆角矩形
-   浅色填充 + 同色边框
-   icon + 文案
-   与 Labs 页面主视觉体系保持一致

------------------------------------------------------------------------

## 8. 搜索结果卡片规范

### 8.1 公共结构

所有结果卡片都包含：

-   类型徽章
-   日期
-   标题（hover 变色）
-   描述（可选）
-   Tags
-   Hover CTA（箭头）

------------------------------------------------------------------------

### 8.2 Notes 专属内容

Notes 卡片额外显示：

-   `preview` 文本片段（等宽字体）
-   用于快速判断上下文

------------------------------------------------------------------------

### 8.3 Labs 专属内容

Labs 卡片特点：

-   **结构与 Notes 高度一致**
-   不显示 preview（避免冗余）
-   保持"相似但不相同"

------------------------------------------------------------------------

## 9. 结果统计条（Counts Bar）

位置： - 搜索栏下方 - 横向圆角矩形（sticky）

内容：

  项         含义
  ---------- --------------
  总结果数   当前匹配结果
  笔记数     Notes 命中数
  实验数     Labs 命中数

设计目的：

> **信息明确，但不打扰输入行为**

------------------------------------------------------------------------

## 10. 交互与动效

-   搜索栏：hover 显示柔和渐变光晕
-   卡片：
    -   hover 浮起
    -   标题变色（Notes 蓝 / Labs 紫）
    -   CTA 圆点显现
-   所有动效仅使用：
    -   `opacity`
    -   `transform`

------------------------------------------------------------------------

## 11. 性能优化策略

1.  **索引预处理**
    -   Notes / Labs 先构建 `haystack`
    -   输入时只做 `includes`
2.  **useMemo 缓存**
    -   labIndex
    -   noteIndex
    -   results
    -   counts
3.  **最小重渲染**
    -   输入只影响过滤
    -   不触发布局重排

------------------------------------------------------------------------

## 12. 扩展规范

### 12.1 新增可搜索类型（示例）

``` ts
{ kind: "project"; item: ProjectItem }
```

步骤： 1. 添加数据源 2. 构建 index 3. 增加 TypeBadge 样式 4. 扩展统计条

------------------------------------------------------------------------

### 12.2 禁止事项（设计红线）

❌ 在搜索页混用 Labs 卡片样式\
❌ 让用户猜"这是笔记还是实验"\
❌ 把搜索做成重型系统\
❌ 引入不必要的依赖或后端搜索

------------------------------------------------------------------------

## 13. 设计哲学总结

> **搜索不是炫技，而是信任感。**

-   快速
-   明确
-   稳定
-   可扩展

这套 Search 系统的目标是：

> **用户不需要思考"我在搜什么系统"，\
> 只需要输入他们想找的东西。**

------------------------------------------------------------------------

© Personal Blog · Search System
